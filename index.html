<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QWIKKEN â€” Project Overview</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:       #080c16;
      --surface:  #0c1120;
      --card:     #1a2235;
      --card-hov: #1f2a40;
      --border:   rgba(255,255,255,0.12);
      --border2:  rgba(255,255,255,0.20);
      --cyan:     #00d4ff;
      --rose:     #f43f5e;
      --blue:     #3b82f6;
      --emerald:  #10b981;
      --violet:   #8b5cf6;
      --amber:    #f59e0b;
      --text:     #ffffff;
      --muted:    #cbd5e1;
      --sidebar-w: 220px;
    }

    html, body { height: 100%; overflow: hidden; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      display: flex;
    }

    /* â”€â”€ SIDEBAR â”€â”€ */
    .sidebar {
      width: var(--sidebar-w);
      flex-shrink: 0;
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,.08); border-radius: 4px; }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px 16px 18px;
      border-bottom: 1px solid var(--border);
    }

    .logo-icon {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, var(--cyan), #0099cc);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 700;
      font-size: 16px;
      color: #000;
      flex-shrink: 0;
    }

    .logo-name {
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 700;
      font-size: 14px;
      color: #fff;
      letter-spacing: .04em;
    }

    .logo-sub {
      font-size: 10px;
      color: var(--cyan);
      font-weight: 600;
      letter-spacing: .08em;
      text-transform: uppercase;
    }

    .nav { padding: 12px 0; flex: 1; }

    .nav-section {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .10em;
      text-transform: uppercase;
      padding: 14px 16px 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 7px 16px;
      font-size: 13px;
      color: #94a3b8;
      cursor: pointer;
      border-left: 2px solid transparent;
      transition: all .15s;
    }

    .nav-item:hover { color: var(--text); background: rgba(255,255,255,.03); }

    .nav-item.active {
      color: #fff;
      border-left-color: var(--cyan);
      background: rgba(0,212,255,.05);
    }

    .nav-num {
      font-size: 10px;
      font-weight: 600;
      color: inherit;
      opacity: .6;
      width: 18px;
      flex-shrink: 0;
    }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
      font-size: 11px;
      color: var(--muted);
    }

    .sidebar-footer span { color: var(--cyan); }

    /* â”€â”€ MAIN â”€â”€ */
    .main {
      flex: 1;
      height: 100vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .main::-webkit-scrollbar { width: 6px; }
    .main::-webkit-scrollbar-thumb { background: rgba(255,255,255,.08); border-radius: 4px; }

    /* â”€â”€ TOPBAR â”€â”€ */
    .topbar {
      padding: 24px 40px 20px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 10;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .breadcrumb-tag {
      background: rgba(0,212,255,.12);
      border: 1px solid rgba(0,212,255,.25);
      color: var(--cyan);
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 6px;
    }

    .breadcrumb-sep { color: var(--muted); font-size: 12px; }
    .breadcrumb-text { font-size: 13px; color: #94a3b8; }

    .topbar h1 {
      font-family: 'Cinzel', serif;
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      letter-spacing: .02em;
      line-height: 1.1;
    }

    .topbar-sub {
      font-size: 14px;
      color: #94a3b8;
      margin-top: 4px;
    }

    .topbar-kpis {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    .topbar-kpi {
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .topbar-kpi-val {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--cyan);
    }

    .topbar-kpi-label { font-size: 12px; color: #94a3b8; }

    /* â”€â”€ CONTENT â”€â”€ */
    .content { padding: 28px 40px 48px; }

    /* â”€â”€ SECTION HEADER â”€â”€ */
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      margin-top: 32px;
    }

    .section-header:first-child { margin-top: 0; }

    .section-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .section-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .10em;
      text-transform: uppercase;
    }

    .section-line {
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* â”€â”€ CARD GRID â”€â”€ */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 8px;
    }

    @media (max-width: 1200px) { .card-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 900px)  { .card-grid { grid-template-columns: repeat(2, 1fr); } }

    /* â”€â”€ CARD â”€â”€ */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
      position: relative;
      cursor: default;
      transition: background .15s, border-color .15s, transform .15s;
    }

    .card:hover {
      background: var(--card-hov);
      border-color: var(--border2);
      transform: translateY(-2px);
    }

    .card-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 14px;
    }

    .card-num {
      width: 32px; height: 32px;
      border-radius: 9px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 13px;
      font-weight: 700;
      color: #fff;
      flex-shrink: 0;
    }

    .card-tag {
      font-size: 9px;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      padding: 3px 8px;
      border-radius: 5px;
      border: 1px solid;
    }

    .tag-barriera { background: rgba(244,63,94,.12); border-color: rgba(244,63,94,.3); color: var(--rose); }
    .tag-core     { background: rgba(0,212,255,.10);  border-color: rgba(0,212,255,.3);  color: var(--cyan); }
    .tag-engine   { background: rgba(16,185,129,.10); border-color: rgba(16,185,129,.3); color: var(--emerald); }
    .tag-key      { background: rgba(245,158,11,.10); border-color: rgba(245,158,11,.3); color: var(--amber); }
    .tag-moat     { background: rgba(139,92,246,.10); border-color: rgba(139,92,246,.3); color: var(--violet); }

    .card h3 {
      font-family: 'Cinzel', serif;
      font-size: 16px;
      font-weight: 700;
      color: #ffffff;
      line-height: 1.3;
      margin-bottom: 10px;
      letter-spacing: .02em;
    }

    .card p {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.6;
    }

    /* badge colors per section */
    .num-cyan    { background: rgba(0,212,255,.18);   color: var(--cyan); }
    .num-rose    { background: rgba(244,63,94,.18);   color: var(--rose); }
    .num-blue    { background: rgba(59,130,246,.18);  color: var(--blue); }
    .num-emerald { background: rgba(16,185,129,.18);  color: var(--emerald); }
    .num-violet  { background: rgba(139,92,246,.18);  color: var(--violet); }
    .num-amber   { background: rgba(245,158,11,.18);  color: var(--amber); }

    /* â”€â”€ CARD CURSOR â”€â”€ */
    .card { cursor: pointer; }

    /* â”€â”€ MODAL OVERLAY â”€â”€ */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(4, 7, 18, 0.92);
      backdrop-filter: blur(12px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .modal-overlay.open {
      display: flex;
      animation: fadeIn .18s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    .modal-box {
      background: #111827;
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 24px;
      padding: 56px 64px;
      max-width: 820px;
      width: 100%;
      position: relative;
      animation: slideUp .22s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(24px); opacity: 0; }
      to   { transform: translateY(0);    opacity: 1; }
    }

    .modal-close {
      position: absolute;
      top: 24px; right: 28px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 8px;
      color: #94a3b8;
      font-size: 18px;
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: background .15s, color .15s;
    }

    .modal-close:hover { background: rgba(255,255,255,.12); color: #fff; }

    .modal-top {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 32px;
    }

    .modal-num {
      width: 52px; height: 52px;
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 20px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .modal-tag {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .10em;
      text-transform: uppercase;
      padding: 5px 12px;
      border-radius: 6px;
      border: 1px solid;
    }

    .modal-title {
      font-family: 'Cinzel', serif;
      font-size: 2.2rem;
      font-weight: 700;
      color: #ffffff;
      line-height: 1.2;
      margin-bottom: 24px;
      letter-spacing: .02em;
    }

    .modal-body {
      font-size: 1.15rem;
      color: #cbd5e1;
      line-height: 1.8;
    }

    .modal-body strong { color: #ffffff; }

    .modal-hint {
      margin-top: 40px;
      font-size: 12px;
      color: #475569;
      text-align: center;
      letter-spacing: .04em;
    }

    /* â”€â”€ TOPBAR ROW â”€â”€ */
    .topbar-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .ai-toggle-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, rgba(0,212,255,.12), rgba(59,130,246,.12));
      border: 1px solid rgba(0,212,255,.30);
      border-radius: 10px;
      color: var(--cyan);
      font-family: 'Space Grotesk', sans-serif;
      font-size: 13px;
      font-weight: 600;
      padding: 10px 18px;
      cursor: pointer;
      transition: all .18s;
      letter-spacing: .02em;
      flex-shrink: 0;
      white-space: nowrap;
    }

    .ai-toggle-btn:hover {
      background: linear-gradient(135deg, rgba(0,212,255,.22), rgba(59,130,246,.22));
      border-color: rgba(0,212,255,.55);
      transform: translateY(-1px);
    }

    .ai-toggle-btn.active {
      background: rgba(0,212,255,.18);
      border-color: var(--cyan);
    }

    /* â”€â”€ AI PANEL â”€â”€ */
    .ai-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 420px;
      height: 100vh;
      background: #0c1120;
      border-left: 1px solid rgba(0,212,255,.18);
      display: flex;
      flex-direction: column;
      z-index: 500;
      transform: translateX(100%);
      transition: transform .28s cubic-bezier(.4,0,.2,1);
      box-shadow: -12px 0 48px rgba(0,0,0,.5);
    }

    .ai-panel.open { transform: translateX(0); }

    .ai-panel-header {
      padding: 20px 20px 16px;
      border-bottom: 1px solid rgba(255,255,255,.07);
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .ai-panel-icon {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, var(--cyan), #0077aa);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 15px;
      color: #000;
      flex-shrink: 0;
    }

    .ai-panel-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 15px;
      font-weight: 700;
      color: #fff;
    }

    .ai-panel-sub {
      font-size: 11px;
      color: #475569;
    }

    .ai-panel-close {
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.09);
      border-radius: 8px;
      color: #64748b;
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: all .15s;
      font-size: 14px;
    }

    .ai-panel-close:hover { background: rgba(255,255,255,.12); color: #fff; }

    .ai-model-bar {
      padding: 10px 16px;
      border-bottom: 1px solid rgba(255,255,255,.05);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .ai-model-label { font-size: 11px; color: #475569; flex-shrink: 0; }

    .ai-model-select {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.09);
      border-radius: 7px;
      color: #cbd5e1;
      font-size: 12px;
      font-family: 'Inter', sans-serif;
      padding: 5px 10px;
      cursor: pointer;
      outline: none;
      flex: 1;
    }

    .ai-model-select:focus { border-color: rgba(0,212,255,.4); }

    .ai-key-btn {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.09);
      border-radius: 7px;
      color: #64748b;
      font-size: 11px;
      padding: 5px 10px;
      cursor: pointer;
      transition: all .15s;
    }

    .ai-key-btn:hover { color: #94a3b8; border-color: rgba(255,255,255,.2); }

    .ai-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .ai-messages::-webkit-scrollbar { width: 4px; }
    .ai-messages::-webkit-scrollbar-thumb { background: rgba(255,255,255,.07); border-radius: 4px; }

    .ai-empty {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      color: #334155;
      text-align: center;
      padding: 32px 20px;
      pointer-events: none;
    }

    .ai-empty-icon { font-size: 36px; opacity: .35; }
    .ai-empty-text { font-size: 13px; line-height: 1.65; }

    .ai-msg {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .ai-msg.user { flex-direction: row-reverse; }

    .ai-msg-avatar {
      width: 28px; height: 28px;
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .ai-msg.user .ai-msg-avatar {
      background: rgba(59,130,246,.2);
      color: var(--blue);
    }

    .ai-msg.assistant .ai-msg-avatar {
      background: linear-gradient(135deg, rgba(0,212,255,.22), rgba(0,119,170,.22));
      color: var(--cyan);
    }

    .ai-msg-bubble {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 13px;
      line-height: 1.65;
      color: #cbd5e1;
      max-width: calc(100% - 44px);
      word-break: break-word;
    }

    .ai-msg.user .ai-msg-bubble {
      background: rgba(59,130,246,.1);
      border-color: rgba(59,130,246,.18);
      color: #e2e8f0;
    }

    .ai-msg.assistant .ai-msg-bubble strong { color: #fff; }

    .ai-input-area {
      padding: 14px 16px;
      border-top: 1px solid rgba(255,255,255,.07);
      flex-shrink: 0;
    }

    .ai-textarea-wrap {
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.09);
      border-radius: 12px;
      padding: 12px 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      transition: border-color .15s;
    }

    .ai-textarea-wrap:focus-within { border-color: rgba(0,212,255,.32); }

    .ai-textarea {
      background: transparent;
      border: none;
      color: #e2e8f0;
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      line-height: 1.5;
      resize: none;
      outline: none;
      min-height: 60px;
      max-height: 150px;
      width: 100%;
    }

    .ai-textarea::placeholder { color: #3d4f6b; }

    .ai-textarea-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .ai-hint-text { font-size: 11px; color: #2d3748; }

    .ai-send-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, var(--cyan), #0099cc);
      border: none;
      border-radius: 8px;
      color: #000;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 12px;
      font-weight: 700;
      padding: 8px 14px;
      cursor: pointer;
      transition: opacity .15s, transform .15s;
      letter-spacing: .02em;
    }

    .ai-send-btn:hover { opacity: .85; transform: translateY(-1px); }
    .ai-send-btn:disabled { opacity: .35; cursor: not-allowed; transform: none; }

    .ai-typing-bubble {
      display: flex;
      gap: 5px;
      align-items: center;
      padding: 12px 14px;
    }

    .ai-typing-bubble span {
      width: 6px; height: 6px;
      background: var(--cyan);
      border-radius: 50%;
      animation: aiTyping 1s infinite;
    }

    .ai-typing-bubble span:nth-child(2) { animation-delay: .18s; }
    .ai-typing-bubble span:nth-child(3) { animation-delay: .36s; }

    @keyframes aiTyping {
      0%, 75%, 100% { opacity: .2; transform: scale(1); }
      40% { opacity: 1; transform: scale(1.35); }
    }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-icon">Q</div>
    <div>
      <div class="logo-name">QWIKKEN</div>
      <div class="logo-sub">Project Overview</div>
    </div>
  </div>

  <nav class="nav">

    <div class="nav-section" style="color:var(--cyan)">1. IdentitÃ  & Visione</div>
    <div class="nav-item active"><span class="nav-num">01</span>Sovereign Cognitive Tutor</div>
    <div class="nav-item"><span class="nav-num">02</span>Vision & Mission</div>
    <div class="nav-item"><span class="nav-num">03</span>Principi Fondamentali</div>

    <div class="nav-section" style="color:var(--rose)">2. Il Problema</div>
    <div class="nav-item"><span class="nav-num">04</span>Allucinazioni</div>
    <div class="nav-item"><span class="nav-num">05</span>No Struttura Curricolare</div>
    <div class="nav-item"><span class="nav-num">06</span>No Verifica & Audit</div>

    <div class="nav-section" style="color:var(--blue)">3. La Soluzione</div>
    <div class="nav-item"><span class="nav-num">07</span>Architettura EGEMON</div>
    <div class="nav-item"><span class="nav-num">08</span>MMS Kernel</div>
    <div class="nav-item"><span class="nav-num">09</span>Il Genoma</div>

    <div class="nav-section" style="color:var(--emerald)">4. I 5 Engine</div>
    <div class="nav-item"><span class="nav-num">10</span>SENSORIUM</div>
    <div class="nav-item"><span class="nav-num">11</span>SYNAPSE</div>
    <div class="nav-item"><span class="nav-num">12</span>SOCRATES</div>
    <div class="nav-item"><span class="nav-num">13</span>ARENA</div>
    <div class="nav-item"><span class="nav-num">14</span>SENTINEL</div>

    <div class="nav-section" style="color:var(--violet)">5. Cognitive Twin</div>
    <div class="nav-item"><span class="nav-num">15</span>Il Gemello Cognitivo</div>
    <div class="nav-item"><span class="nav-num">16</span>QWIKKEN IS FOREVER</div>
    <div class="nav-item"><span class="nav-num">17</span>Genesis Certificate</div>

    <div class="nav-section" style="color:var(--amber)">6. Business & Numeri</div>
    <div class="nav-item"><span class="nav-num">18</span>Model Cascading</div>
    <div class="nav-item"><span class="nav-num">19</span>Metriche & LTV</div>
    <div class="nav-item"><span class="nav-num">20</span>Moat Competitivi</div>

  </nav>

  <div class="sidebar-footer">
    <span>Synthetic Data S.r.l.</span><br/>
    Monografia Tecnica Â· Rev 1.0 Â· 2026
  </div>
</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-row">
      <div>
        <div class="breadcrumb">
          <span class="breadcrumb-tag">KNOWLEDGE ARCHITECTURE</span>
          <span class="breadcrumb-sep">Â·</span>
          <span class="breadcrumb-text">The Sovereign Cognitive Tutor</span>
        </div>
        <h1>QWIKKEN Project</h1>
        <p class="topbar-sub">Architettura Neuro-Simbolica per l'Education AI &nbsp;Â·&nbsp; Synthetic Data S.r.l.</p>
      </div>
      <button class="ai-toggle-btn" id="ai-toggle-btn">
        <i class="fa-solid fa-robot"></i>
        <span>Ask AI</span>
      </button>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content">

    <!-- â”€â”€ SEZIONE 1 â”€â”€ -->
    <div class="section-header">
      <div class="section-dot" style="background:var(--cyan)"></div>
      <div class="section-label" style="color:var(--cyan)">1. IdentitÃ  & Visione</div>
      <div class="section-line"></div>
    </div>
    <div class="card-grid">

      <div class="card">
        <div class="card-top">
          <div class="card-num num-cyan">01</div>
          <span class="card-tag tag-core">CORE</span>
        </div>
        <h3>Sovereign Cognitive Tutor</h3>
        <p>Il primo tutor AI progettato per garantire <strong>determinismo, tracciabilitÃ  e affidabilitÃ </strong> nell'apprendimento. Architettura neuro-simbolica proprietaria.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-cyan">02</div>
        </div>
        <h3>Vision & Mission</h3>
        <p>Creare un compagno cognitivo che accompagni ogni individuo dall'universitÃ  alla pensione. Democratizzare il tutoring personalizzato di alta qualitÃ .</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-cyan">03</div>
        </div>
        <h3>Principi Fondamentali</h3>
        <p><strong>Determinismo</strong> Â· risposte verificabili. <strong>TracciabilitÃ </strong> Â· audit completo. <strong>SovranitÃ </strong> Â· GDPR-native. <strong>Personalizzazione</strong> Â· Cognitive Twin. <strong>Integrazione</strong> Â· LMS nativa.</p>
      </div>

    </div>

    <!-- â”€â”€ SEZIONE 2 â”€â”€ -->
    <div class="section-header">
      <div class="section-dot" style="background:var(--rose)"></div>
      <div class="section-label" style="color:var(--rose)">2. Il Problema</div>
      <div class="section-line"></div>
    </div>
    <div class="card-grid">

      <div class="card">
        <div class="card-top">
          <div class="card-num num-rose">04</div>
          <span class="card-tag tag-barriera">BARRIERA</span>
        </div>
        <h3>Allucinazioni</h3>
        <p>I LLM generici producono errori fattuali nel <strong>15-20% delle risposte</strong>. In Education questo Ã¨ inaccettabile: uno studente non puÃ² memorizzare informazioni sbagliate.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-rose">05</div>
          <span class="card-tag tag-barriera">BARRIERA</span>
        </div>
        <h3>No Struttura Curricolare</h3>
        <p>ChatGPT ignora prerequisiti, propedeuticitÃ  e obiettivi del corso. Non sa che per capire Analisi 2 serve prima Analisi 1. Risponde a domande isolate senza contesto.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-rose">06</div>
          <span class="card-tag tag-barriera">BARRIERA</span>
        </div>
        <h3>No Verifica & Certificazione</h3>
        <p>Senza audit trail completo nessuna universitÃ  puÃ² adottare AI generica. Compliance, tracciabilitÃ  delle fonti e certificazione sono requisiti non negoziabili.</p>
      </div>

    </div>

    <!-- â”€â”€ SEZIONE 3 â”€â”€ -->
    <div class="section-header">
      <div class="section-dot" style="background:var(--blue)"></div>
      <div class="section-label" style="color:var(--blue)">3. La Soluzione: EGEMON</div>
      <div class="section-line"></div>
    </div>
    <div class="card-grid">

      <div class="card">
        <div class="card-top">
          <div class="card-num num-blue">07</div>
          <span class="card-tag tag-core">CORE</span>
        </div>
        <h3>Architettura EGEMON</h3>
        <p><strong>Educational GEnerative MONitor</strong> â€” cuore tecnologico proprietario. Combina inferenza neurale (LLM) con reasoning simbolico (Knowledge Graph + Rule Engine).</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-blue">08</div>
          <span class="card-tag tag-core">CORE</span>
        </div>
        <h3>MMS Kernel</h3>
        <p><strong>Multi-Modal Symbolic Kernel</strong> â€” orchestratore centrale. Pipeline: Parser â†’ Router â†’ Retriever â†’ Generator â†’ Validator. Zero allucinazioni sui contenuti del corso.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-blue">09</div>
        </div>
        <h3>Il Genoma</h3>
        <p>Knowledge Graph curricolare a 5 livelli: Curriculum â†’ Course â†’ Module â†’ Topic â†’ Concept. Il DNA del corso che contestualizza ogni risposta nel percorso didattico.</p>
      </div>

    </div>

    <!-- â”€â”€ SEZIONE 4 â”€â”€ -->
    <div class="section-header">
      <div class="section-dot" style="background:var(--emerald)"></div>
      <div class="section-label" style="color:var(--emerald)">4. I 5 Engine Subsystem</div>
      <div class="section-line"></div>
    </div>
    <div class="card-grid">

      <div class="card">
        <div class="card-top">
          <div class="card-num num-emerald">10</div>
          <span class="card-tag tag-engine">ENGINE</span>
        </div>
        <h3>SENSORIUM</h3>
        <p>Document ingestion, parsing e indicizzazione dei materiali didattici. Supporta PDF, DOCX, PPTX, video transcript. Fino a 10.000 documenti per corso, multilingua.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-emerald">11</div>
          <span class="card-tag tag-engine">ENGINE</span>
        </div>
        <h3>SYNAPSE</h3>
        <p>Knowledge Graph Engine â€” gestisce il Genoma e le relazioni curricolari: REQUIRES, PART_OF, RELATED_TO, ASSESSED_BY. Garantisce coerenza didattica in ogni risposta.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-emerald">12</div>
          <span class="card-tag tag-engine">ENGINE</span>
        </div>
        <h3>SOCRATES</h3>
        <p>Tutoring conversazionale maieutico. Non fornisce risposte dirette â€” guida lo studente alla scoperta attraverso domande e hint. Metodo Vygotsky (Zona di Sviluppo Prossimale).</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-emerald">13</div>
          <span class="card-tag tag-engine">ENGINE</span>
        </div>
        <h3>ARENA</h3>
        <p>Assessment Engine â€” quiz adattivi, simulazioni esame complete, feedback dettagliato. DifficoltÃ  adattiva basata sul profilo dello studente. Active recall procedurale.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-emerald">14</div>
          <span class="card-tag tag-engine">ENGINE</span>
        </div>
        <h3>SENTINEL</h3>
        <p>Governance Engine â€” audit trail completo, explainability (XAI), compliance AI Act EU. Ogni decisione loggata e spiegabile. Prerequisito per adozione universitaria istituzionale.</p>
      </div>

    </div>

    <!-- â”€â”€ SEZIONE 5 â”€â”€ -->
    <div class="section-header">
      <div class="section-dot" style="background:var(--violet)"></div>
      <div class="section-label" style="color:var(--violet)">5. Cognitive Twin</div>
      <div class="section-line"></div>
    </div>
    <div class="card-grid">

      <div class="card">
        <div class="card-top">
          <div class="card-num num-violet">15</div>
          <span class="card-tag tag-moat">MOAT</span>
        </div>
        <h3>Il Gemello Cognitivo</h3>
        <p>Rappresentazione digitale persistente del profilo cognitivo. Anno 1: stile di apprendimento. Anno 5: predice i bisogni futuri. Anno 10+: archivio irriproducibile dell'evoluzione intellettuale.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-violet">16</div>
          <span class="card-tag tag-moat">FOREVER</span>
        </div>
        <h3>QWIKKEN IS FOREVER</h3>
        <p>Il Cognitive Twin non si laurea quando ti laurei tu. Continua per tutta la vita: UniversitÃ  â†’ Early Career â†’ Mid Career â†’ Executive â†’ Active Aging. <strong>45+ anni</strong> di relazione.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-violet">17</div>
        </div>
        <h3>Genesis Certificate</h3>
        <p>Ogni output significativo (riassunti, simulazioni, esercizi) riceve un certificato che attesta data, fonti, versione modello e livello di assistenza AI vs contributo umano.</p>
      </div>

    </div>

    <!-- â”€â”€ SEZIONE 6 â”€â”€ -->
    <div class="section-header">
      <div class="section-dot" style="background:var(--amber)"></div>
      <div class="section-label" style="color:var(--amber)">6. Business & Numeri</div>
      <div class="section-line"></div>
    </div>
    <div class="card-grid">

      <div class="card">
        <div class="card-top">
          <div class="card-num num-amber">18</div>
          <span class="card-tag tag-key">KEY</span>
        </div>
        <h3>Model Cascading</h3>
        <p>Routing intelligente: L1 Flash (85% traffico, â‚¬0.10/M) â†’ L2 Pro (13%) â†’ L3 Extended (2%). Risultato: <strong>â‚¬1.99/studente/anno</strong> vs â‚¬15-20 senza ottimizzazione. -85% costi.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-amber">19</div>
          <span class="card-tag tag-key">KEY</span>
        </div>
        <h3>Metriche & LTV</h3>
        <p>Investimento: <strong>â‚¬300k</strong> Â· Break-even: <strong>Year 1</strong> Â· LTV Education Only: â‚¬245 Â· LTV Lifelong Model: <strong>â‚¬800â€“1.200</strong> (+5x) Â· Churn annuale: -40% vs competitori.</p>
      </div>

      <div class="card">
        <div class="card-top">
          <div class="card-num num-amber">20</div>
          <span class="card-tag tag-moat">MOAT</span>
        </div>
        <h3>5 Moat Competitivi</h3>
        <p><strong>Technology</strong>: MMS + Genoma proprietari. <strong>Data</strong>: Twin irriproducibile. <strong>Network</strong>: flywheel studenti. <strong>Integration</strong>: LMS switching cost. <strong>Trust</strong>: GDPR + AI Act EU.</p>
      </div>

    </div>

  </div><!-- /content -->
</div><!-- /main -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AI PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="ai-panel" id="ai-panel">

  <div class="ai-panel-header">
    <div class="ai-panel-icon"><i class="fa-solid fa-robot"></i></div>
    <div style="flex:1">
      <div class="ai-panel-title">QWIKKEN AI</div>
      <div class="ai-panel-sub">Rispondi domande sulla documentazione</div>
    </div>
    <button class="ai-panel-close" id="ai-panel-close"><i class="fa-solid fa-xmark"></i></button>
  </div>

  <div class="ai-model-bar">
    <span class="ai-model-label">Modello:</span>
    <select class="ai-model-select" id="ai-model-select">
      <option value="google/gemini-flash-1.5">Gemini Flash (veloce)</option>
      <option value="anthropic/claude-opus-4-5">Claude Opus 4.5 (profondo)</option>
    </select>
    <button class="ai-key-btn" id="ai-key-btn" title="Imposta API Key">
      <i class="fa-solid fa-key"></i>
    </button>
  </div>

  <div class="ai-messages" id="ai-messages">
    <div class="ai-empty" id="ai-empty">
      <div class="ai-empty-icon"><i class="fa-solid fa-comments"></i></div>
      <div class="ai-empty-text">
        Scrivi una domanda sulla documentazione QWIKKEN.<br/>
        L'AI risponderÃ  in base alla monografia tecnica, al business plan e alla visione strategica.
      </div>
    </div>
  </div>

  <div class="ai-input-area">
    <div class="ai-textarea-wrap">
      <textarea
        class="ai-textarea"
        id="ai-textarea"
        spellcheck="true"
        placeholder="Scrivi la tua domanda su QWIKKEN..."
        rows="3"
      ></textarea>
      <div class="ai-textarea-actions">
        <span class="ai-hint-text">Invio Â· Shift+Invio per andare a capo</span>
        <button class="ai-send-btn" id="ai-send-btn">
          <i class="fa-solid fa-paper-plane"></i>
          Invia
        </button>
      </div>
    </div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modal">
  <div class="modal-box">
    <button class="modal-close" id="modal-close"><i class="fa-solid fa-xmark"></i></button>
    <div class="modal-top">
      <div class="modal-num" id="modal-num"></div>
      <span class="modal-tag" id="modal-tag" style="display:none"></span>
    </div>
    <div class="modal-title" id="modal-title"></div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-hint">ESC o click fuori per chiudere</div>
  </div>
</div>

<script>
  // Sidebar nav highlight
  document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
      item.classList.add('active');
    });
  });

  // Modal logic
  const overlay   = document.getElementById('modal');
  const modalNum  = document.getElementById('modal-num');
  const modalTag  = document.getElementById('modal-tag');
  const modalTitle = document.getElementById('modal-title');
  const modalBody  = document.getElementById('modal-body');

  function openModal(card) {
    const num   = card.querySelector('.card-num');
    const tag   = card.querySelector('.card-tag');
    const title = card.querySelector('h3');
    const body  = card.querySelector('p');

    // Copy num badge style
    modalNum.textContent = num.textContent;
    modalNum.className   = 'modal-num ' + num.className.replace('card-num', '').trim();

    // Tag (optional)
    if (tag) {
      modalTag.textContent = tag.textContent;
      modalTag.className   = 'modal-tag ' + tag.className.replace('card-tag', '').trim();
      modalTag.style.display = 'inline-block';
    } else {
      modalTag.style.display = 'none';
    }

    modalTitle.textContent = title.textContent;
    modalBody.innerHTML    = body.innerHTML;

    overlay.classList.add('open');
  }

  function closeModal() {
    overlay.classList.remove('open');
  }

  document.querySelectorAll('.card').forEach(card => {
    card.addEventListener('click', () => openModal(card));
  });

  document.getElementById('modal-close').addEventListener('click', closeModal);

  overlay.addEventListener('click', e => {
    if (e.target === overlay) closeModal();
  });

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      closeModal();
      aiPanel.classList.remove('open');
      aiToggleBtn.classList.remove('active');
    }
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  AI PANEL â€” QWIKKEN Knowledge Assistant
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const DOCS_CONTEXT = `
# QWIKKEN â€” Documentazione di Riferimento (Sintesi Operativa)
Synthetic Data S.r.l. Â· Rev. 1.0 Â· Gennaio 2026

## 1. IdentitÃ 
QWIKKEN Ã¨ il primo tutor AI cognitivo progettato per garantire determinismo, tracciabilitÃ  e affidabilitÃ  nell'apprendimento. Architettura neuro-simbolica proprietaria. Slogan: "The Sovereign Cognitive Tutor". Fondata da Graziano Guiducci e Lorenzo Bosio (Synthetic Data S.r.l.).

Nome: QWIKKEN evoca "quick" (rapiditÃ ) e "quicken" (vivificare, accelerare). Rappresenta la capacitÃ  di accelerare l'apprendimento mantenendo profonditÃ  e rigore.

## 2. Il Problema: Le Tre Barriere dell'AI in Education
1. **Allucinazioni**: LLM generici producono errori fattuali nel 15-20% delle risposte. Uno studente non puÃ² memorizzare informazioni errate.
2. **No Struttura Curricolare**: ChatGPT ignora prerequisiti, propedeuticitÃ , obiettivi del corso. Non sa che per capire Analisi 2 serve prima Analisi 1.
3. **No Verifica e Certificazione**: Senza audit trail completo nessuna universitÃ  puÃ² adottare AI generica. Compliance e tracciabilitÃ  sono requisiti non negoziabili.

## 3. Principi Fondamentali
- Determinismo: ogni risposta verificabile e riproducibile (architettura MMS)
- TracciabilitÃ : audit trail completo con citazioni delle fonti
- SovranitÃ : GDPR-native, lo studente controlla i propri dati, portabilitÃ 
- Personalizzazione: percorsi adattivi basati sul Cognitive Twin persistente
- Integrazione: compatibilitÃ  nativa con ecosistemi LMS (Moodle, Blackboard)

## 4. Architettura EGEMON
EGEMON = Educational GEnerative MONitor. Cuore tecnologico proprietario. Combina inferenza neurale (LLM) con reasoning simbolico (Knowledge Graph + Rule Engine). Zero allucinazioni sui contenuti del corso.

## 5. MMS Kernel
MMS = Multi-Modal Symbolic Kernel. Orchestratore centrale. Pipeline: Parser â†’ Router â†’ Retriever â†’ Generator â†’ Validator. Zero allucinazioni sui contenuti del corso.

## 6. Il Genoma (Knowledge Graph Curricolare)
Knowledge Graph curricolare a 5 livelli: Curriculum â†’ Course â†’ Module â†’ Topic â†’ Concept. Il DNA del corso che contestualizza ogni risposta nel percorso didattico. Relazioni: REQUIRES, PART_OF, RELATED_TO, ASSESSED_BY.

## 7. I 5 Engine Subsystem
- **SENSORIUM**: Document ingestion, parsing e indicizzazione. Supporta PDF, DOCX, PPTX, video transcript. Fino a 10.000 documenti per corso, multilingua.
- **SYNAPSE**: Knowledge Graph Engine. Gestisce il Genoma e le relazioni curricolari. Garantisce coerenza didattica in ogni risposta.
- **SOCRATES**: Tutoring conversazionale maieutico. Non fornisce risposte dirette â€” guida lo studente alla scoperta attraverso domande e hint. Metodo Vygotsky (Zona di Sviluppo Prossimale).
- **ARENA**: Assessment Engine. Quiz adattivi, simulazioni esame complete, feedback dettagliato. DifficoltÃ  adattiva. Active recall procedurale.
- **SENTINEL**: Governance Engine. Audit trail completo, explainability (XAI), compliance AI Act EU. Ogni decisione loggata e spiegabile.

## 8. Cognitive Twin (Il Gemello Cognitivo)
Rappresentazione digitale persistente del profilo cognitivo. Anno 1: stile di apprendimento. Anno 5: predice i bisogni futuri. Anno 10+: archivio irriproducibile dell'evoluzione intellettuale. Non si "laurea" quando l'utente si laurea â€” continua per tutta la vita.

## 9. QWIKKEN IS FOREVER
Paradigma Lifelong Learning: UniversitÃ  â†’ Early Career â†’ Mid Career â†’ Executive â†’ Active Aging. 45+ anni di relazione continua con il Cognitive Twin. LTV (Lifetime Value) straordinario rispetto a competitor con abbonamenti annuali.

## 10. Genesis Certificate
Ogni output significativo (riassunti, simulazioni, esercizi) riceve un certificato che attesta: data, fonti, versione del modello, livello di assistenza AI vs contributo umano. Prerequisito per compliance universitaria.

## 11. Model Cascading & Ottimizzazione dei Costi
Routing intelligente multi-livello:
- L1 Flash: 85% del traffico, costo â‚¬0.10/M token (es. Gemini Flash)
- L2 Pro: 13% del traffico (es. Claude Sonnet)
- L3 Extended: 2% del traffico (es. Claude Opus)
Risultato: â‚¬1.99/studente/anno vs â‚¬15-20 senza ottimizzazione. Risparmio: -85% sui costi AI.

## 12. Business & Metriche
- Investimento richiesto: â‚¬300.000
- Break-even previsto: Year 1
- LTV Education Only: â‚¬245/utente
- LTV Lifelong Model: â‚¬800â€“1.200/utente (+5x rispetto a Education Only)
- Churn annuale: -40% rispetto ai competitori
- Pilot previsto: 2.000 utenti per validazione mercato

## 13. I 5 Moat Competitivi
1. **Technology**: MMS Kernel + Genoma proprietari (non replicabili da API generiche)
2. **Data**: Cognitive Twin irriproducibile (dati comportamentali accumulati nel tempo)
3. **Network**: flywheel studenti â†’ docenti â†’ universitÃ 
4. **Integration**: alto switching cost per integrazione profonda con LMS
5. **Trust**: compliance GDPR + AI Act EU nativa (vantaggio competitivo in Europa)

## 14. Differenziazione vs Competitori
| Caratteristica | ChatGPT/Copilot | QWIKKEN |
|---|---|---|
| Allucinazioni | 15-20% | Quasi zero (bounded reasoning) |
| Struttura curricolare | Non supportata | Nativa (Genoma) |
| Audit trail | Non disponibile | Completo |
| Compliance AI Act EU | Non dichiarata | Nativa |
| Cognitive Twin | Non esiste | Persistente lifelong |
| Integrazione LMS | Plugin basilari | Connector profondo |

## 15. Visione Strategica
**Augmentation Governata**: non sostituzione dell'umano ma potenziamento. Il Twin gestisce la complessitÃ  operativa (memoria, calcoli, compliance); l'umano prende decisioni strategiche.
**Democratizzazione dell'Eccellenza**: PMI con processi da multinazionale; studente di periferia con il tutor del miglior docente del mondo.
**Knowledge come Asset Liquido**: Marketplace Knowledge per assemblare un "Dream Team Virtuale" di expertise.
**PIL della Conoscenza**: il valore non sta nel possedere informazioni ma nel pacchettizzarle in strumenti operativi trasferibili globalmente.

## 16. Stack Tecnologico
- Frontend: React + TypeScript (Vite), mobile-first
- Backend: Node.js + TypeScript
- LLM Router: OpenRouter (Anthropic Claude, Google Gemini)
- Storage: IndexedDB (client-side), PostgreSQL (cloud)
- Deployment: VPS Hostinger
- Auth: sistema proprietario multi-tenant

## 17. QWIKKEN Credit (BCP)
Modulo verticale: Business Credit Profiling e Mediazione Creditizia. Stessa architettura EGEMON applicata al settore credito. Analisi merito creditizio, supporto mediatori, documentazione automatica.

## 18. Piano Operativo
- Fase 1: Pilot con 2.000 utenti, validazione mercato, proof-of-concept con universitÃ  partner
- Fase 2: Scale-up, integrazione LMS profonda, espansione modulo Credit
- Fase 3: Marketplace Knowledge, espansione internazionale, IPO/Exit
`;

  const LS_API_KEY = 'qwikken_openrouter_key';

  const aiPanel    = document.getElementById('ai-panel');
  const aiToggleBtn = document.getElementById('ai-toggle-btn');
  const aiPanelClose = document.getElementById('ai-panel-close');
  const aiMessages = document.getElementById('ai-messages');
  const aiEmpty    = document.getElementById('ai-empty');
  const aiTextarea = document.getElementById('ai-textarea');
  const aiSendBtn  = document.getElementById('ai-send-btn');
  const aiModelSelect = document.getElementById('ai-model-select');
  const aiKeyBtn   = document.getElementById('ai-key-btn');

  let chatHistory = [];

  function getApiKey() {
    let key = localStorage.getItem(LS_API_KEY);
    if (!key) {
      key = prompt('Inserisci la tua OpenRouter API Key per usare QWIKKEN AI:\n(VerrÃ  salvata localmente, non condivisa)');
      if (key && key.trim()) localStorage.setItem(LS_API_KEY, key.trim());
    }
    return key ? key.trim() : null;
  }

  aiToggleBtn.addEventListener('click', () => {
    aiPanel.classList.toggle('open');
    aiToggleBtn.classList.toggle('active');
    if (aiPanel.classList.contains('open')) {
      setTimeout(() => aiTextarea.focus(), 280);
    }
  });

  aiPanelClose.addEventListener('click', () => {
    aiPanel.classList.remove('open');
    aiToggleBtn.classList.remove('active');
  });

  aiKeyBtn.addEventListener('click', () => {
    const current = localStorage.getItem(LS_API_KEY) || '';
    const key = prompt('OpenRouter API Key:', current);
    if (key !== null) localStorage.setItem(LS_API_KEY, key.trim());
  });

  aiTextarea.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendAiMessage();
    }
  });

  aiSendBtn.addEventListener('click', sendAiMessage);

  function appendMsg(role, html) {
    aiEmpty.style.display = 'none';
    const wrap = document.createElement('div');
    wrap.className = `ai-msg ${role}`;

    const avatar = document.createElement('div');
    avatar.className = 'ai-msg-avatar';
    avatar.innerHTML = role === 'user'
      ? '<i class="fa-solid fa-user"></i>'
      : '<i class="fa-solid fa-robot"></i>';

    const bubble = document.createElement('div');
    bubble.className = 'ai-msg-bubble';
    bubble.innerHTML = html;

    wrap.appendChild(avatar);
    wrap.appendChild(bubble);
    aiMessages.appendChild(wrap);
    aiMessages.scrollTop = aiMessages.scrollHeight;
    return bubble;
  }

  function addTypingIndicator() {
    const wrap = document.createElement('div');
    wrap.className = 'ai-msg assistant';
    wrap.id = 'ai-typing-indicator';

    const avatar = document.createElement('div');
    avatar.className = 'ai-msg-avatar';
    avatar.innerHTML = '<i class="fa-solid fa-robot"></i>';

    const bubble = document.createElement('div');
    bubble.className = 'ai-msg-bubble ai-typing-bubble';
    bubble.innerHTML = '<span></span><span></span><span></span>';

    wrap.appendChild(avatar);
    wrap.appendChild(bubble);
    aiMessages.appendChild(wrap);
    aiMessages.scrollTop = aiMessages.scrollHeight;
    return wrap;
  }

  function formatReply(text) {
    return text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.+?)\*/g, '<em>$1</em>')
      .replace(/\n/g, '<br>');
  }

  async function sendAiMessage() {
    const text = aiTextarea.value.trim();
    if (!text) return;

    const key = getApiKey();
    if (!key) return;

    const userText = text;
    aiTextarea.value = '';
    aiSendBtn.disabled = true;

    appendMsg('user', formatReply(userText));
    chatHistory.push({ role: 'user', content: userText });

    const typingEl = addTypingIndicator();

    try {
      const resp = await fetch('https://openrouter.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${key}`,
          'Content-Type': 'application/json',
          'HTTP-Referer': 'https://qwikken.io',
          'X-Title': 'QWIKKEN Project Presentation',
        },
        body: JSON.stringify({
          model: aiModelSelect.value,
          messages: [
            {
              role: 'system',
              content: `Sei l'assistente AI ufficiale di QWIKKEN, la piattaforma cognitive tutoring di Synthetic Data S.r.l. Rispondi in modo preciso, professionale e conciso basandoti ESCLUSIVAMENTE sulla documentazione fornita qui sotto. Se la risposta non Ã¨ contenuta nella documentazione, dichiaralo esplicitamente invece di inventare. Usa il grassetto per i concetti chiave. Rispondi sempre in italiano.\n\n---\n${DOCS_CONTEXT}\n---`
            },
            ...chatHistory
          ],
          max_tokens: 900,
          temperature: 0.3,
        })
      });

      typingEl.remove();

      if (!resp.ok) {
        let errMsg = `Errore HTTP ${resp.status}`;
        try { const e = await resp.json(); errMsg = e.error?.message || errMsg; } catch {}
        if (resp.status === 401) errMsg = 'API Key non valida. Clicca ðŸ”‘ per aggiornarla.';
        appendMsg('assistant', errMsg);
      } else {
        const data = await resp.json();
        const reply = data.choices?.[0]?.message?.content || '(Nessuna risposta ricevuta)';
        appendMsg('assistant', formatReply(reply));
        chatHistory.push({ role: 'assistant', content: reply });
      }

    } catch (err) {
      typingEl.remove();
      appendMsg('assistant', `<strong>Errore di connessione:</strong> ${err.message}`);
    }

    aiSendBtn.disabled = false;
    aiTextarea.focus();
  }
</script>

</body>
</html>
